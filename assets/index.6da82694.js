var V=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var G=(e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t)=>{for(var n in t||(t={}))ne.call(t,n)&&G(e,n,t[n]);if(O)for(var n of O(t))oe.call(t,n)&&G(e,n,t[n]);return e},I=(e,t)=>ee(e,te(t));const re=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}};re();function H(e){const{data:t}=e.getImageData(0,0,e.canvas.width,e.canvas.height),{width:n,height:r}=e.canvas;let a=[];for(let o=0;o<r;o++)for(let s=0;s<n;s++)a[s]||(a[s]=new Uint8Array(r)),a[s][o]=Math.floor((t[o*n*4+s*4]+t[o*n*4+s*4+1]+t[o*n*4+s*4+2])/3);return a}function ae(e,t={}){const{crop:n=!0,size:r}=t;return new Promise(a=>{const o=new window.Image;o.onload=function(){const c=t.canvas||document.createElement("canvas"),l=c.getContext("2d");let i=1;r&&(i=r/Math.max(o.width,o.height)),t.maxSize&&(o.width>t.maxSize||o.height>t.maxSize)&&(i=t.maxSize/Math.max(o.width,o.height));const u=Math.floor(o.width*i),h=Math.floor(o.height*i);if(n){c.width=r,c.height=r;const d=Math.min(o.width,o.height);l.drawImage(o,(o.width-d)/2,(o.height-d)/2,d,d,0,0,r,r)}else c.width=u,c.height=h,l.drawImage(o,0,0,u,h);const g=l.getImageData(0,0,l.canvas.width,l.canvas.height);g.ctx=l,a(g)},o.src=e})}function j(e){e.beginPath();function t(a,o,s={}){const{color:c="#000",width:l=1}=s;e.beginPath(),e.lineWidth=l,e.moveTo(a[0],a[1]),e.lineTo(o[0],o[1]),e.strokeStyle=c,e.stroke()}function n(a,o){e.moveTo(a[0],a[1]),e.lineTo(o[0],o[1])}function r(a={}){const{color:o="#000",width:s=1}=a;e.lineWidth=s,e.strokeStyle=o,e.stroke(),e.beginPath()}return{line:t,lineBuffer:n,stroke:r}}const z=.1,L={r:.299+z,g:.587+z*-.5,b:.114+z*-.5};function se(e){let t=e.data,n=1/0,r=0,a=0;for(let s=0;s<t.length;s+=4){let c=t[s]*L.r+t[s+1]*L.g+t[s+2]*L.b;n=Math.min(n,c),r=Math.max(r,c),a+=c}a=Math.round(a/(t.length/4)),n+=32,r-=32;const o=255/(r-n);for(let s=0;s<t.length;s+=4){let c=t[s]*L.r+t[s+1]*L.g+t[s+2]*L.b;t[s]=Math.round(c*o)-n,t[s+1]=Math.round(c*o)-n,t[s+2]=Math.round(c*o)-n}return{canvasData:e,averageLightness:a}}function _(e,t,n){let r=0;const a=e[0],o=t[0]-e[0],s=e[1],c=t[1]-e[1],l=Math.max(Math.abs(o),Math.abs(c));for(let i=0;i<l;i++){const u=Math.round(a+o/l*i),h=Math.round(s+c/l*i);r+=n[u][h]}return Math.round(r/l)}function D(e,t){return t===void 0?Math.floor(Math.random()*e):Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function X(e,t){let n;return function(){clearTimeout(n);let r=arguments;n=setTimeout(function(){e.apply(this,r)},t||1)}}const ie=1080;let k=null,T=null,x=null;const P=document.createElement("canvas");async function ce(e,t={}){const{canvasDrawEl:n,onDraw:r,onFinish:a,onLoad:o}=t,s=await ae(e,{size:ie,canvas:P,crop:!1}),c=s.width,l=s.height;P.width=c,P.height=l;const i=P.getContext("2d"),u=j(i),h=n||document.createElement("canvas");h.width=c,h.height=l;const g=h.getContext("2d"),d=j(g);console.log("> Starting PINTR"),o&&o({width:c,height:l});const{canvasData:M,averageLightness:S}=se(s);async function E({config:m}){console.log("> Render PINTR",m),x=new Date().getTime(),T=[],i.putImageData(M,0,0),k=H(i);let N=new Date().getTime(),$=[Math.floor(c/2),Math.floor(l/2)];function Z(){let f=$,R=m.singleLine?0:m.precisionRange;for(;R--;){let b=[D(c),D(l)];k[f[0]][f[1]]>k[b[0]][b[1]]&&(f=b)}let B=D(m.precisionRange,m.precisionRange*2),p,F=255;for(;B--;){let b=[D(c),D(l)];const A=_(f,b,k);A<=F&&(F=A,p=b)}F=_(f,p,k),T.push([f,p]),d.lineBuffer(f,p,{color:"#000"}),u.lineBuffer(f,p,{color:m.substractionColor}),$=p}const W=Math.floor(m.baseLineNumber/S*128);let C=W;function J(f){return new Promise(R=>{const B=new Date().getTime();for(;new Date().getTime()<B+15&&C-- >0;){if(f!==x)return;C%m.updateSampleRate==0&&(u.stroke({color:m.substractionColor,width:m.strokeWidth*1.5}),k=H(i)),Z()}d.stroke({color:m.addColor,width:m.strokeWidth*1}),window.requestAnimationFrame(R)})}async function Q(f){for(;C>0&&f===x;)await J(f),r&&r({coords:T});r&&r({coords:T}),a&&a({coords:T});let R=new Date().getTime();console.log("> Lines per second:",W/(R-N)*1e3)}Q(x)}return{render:E}}function le(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${t}">
${e.map(r=>`<line x1="${r[0][0]}" y1="${r[0][1]}" x2="${r[1][0]}" y2="${r[1][1]}"/>`).join(`
`)}
</svg>
  `}function ue(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${e.map(r=>r[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${t}"/>
</svg>
  `}function he(e,t){return console.warn(">generateSvg",t),t.singleLine?ue(e,t):le(e,t)}function U(e,{smoothing:t=.15,strokeWidth:n,size:r}){const a=e.map(i=>i[0]),o=(i,u)=>{const h=u[0]-i[0],g=u[1]-i[1];return{length:Math.sqrt(Math.pow(h,2)+Math.pow(g,2)),angle:Math.atan2(g,h)}},s=(i,u,h,g)=>{const S=o(u||i,h||i),E=S.angle+(g?Math.PI:0),m=S.length*t,N=i[0]+Math.cos(E)*m,$=i[1]+Math.sin(E)*m;return[N,$]},c=(i,u,h)=>{const g=s(h[u-1],h[u-2],i),d=s(i,h[u-1],h[u+1],!0);return`C ${g[0]},${g[1]} ${d[0]},${d[1]} ${i[0]},${i[1]}`},l=(i,u)=>`<path d="${i.reduce((g,d,M,S)=>M===0?`M ${d[0]},${d[1]}`:`${g} ${u(d,M,S)}`,"")}" fill="none" stroke="black" stroke-width="${n}" />`;return`<svg viewBox="0 0 ${r[0]} ${r[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${l(a,c)}
  </svg>
  `}const de="./test.jpg";let v={},w={coords:null,width:null,height:null};async function Y(e){const t=await ce(e,{canvasDrawEl:document.querySelector("canvas#draw"),onDraw({coords:n}){w.coords=n},onLoad({width:n,height:r}){document.documentElement.style.setProperty("--sizew",`${n/2}px`),document.documentElement.style.setProperty("--sizeh",`${r/2}px`),w.width=n,w.height=r},onFinish({coords:n}){if(!v.makeSmoothSvg)return;const r=U(n,I(q({},v),{size:[w.width,w.height],smoothing:Number(document.querySelector("#inputSmoothness").value)/100}));document.querySelector(".smooth-svg-container").innerHTML=r}});document.querySelector("#srcImg").style.backgroundImage=`url("${e}")`,document.querySelector(".loading").style.display="none",t.render({config:v})}function me(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",function(t){Y(t.target.result)}),e.readAsDataURL(this.files[0])}}function y(e,t){return t==="number"?Number(document.querySelector(e).value):t==="bool"?Boolean(Number(document.querySelector(e).value)):document.querySelector(e).value}function K(){const e=y("#lines","number"),t=y("#singleLine","bool"),n=y("#faceApi","bool"),r=y("#contrast","number"),a=y("#definition","number"),o=y("#strokeWidth","number"),s=y("#makeSmoothSvg","bool");v={addColor:"#000",updateSampleRate:90,baseLineNumber:72*e,substractionColor:`rgba(255, 255, 255, ${100-r}%)`,precisionRange:a,singleLine:t,faceApi:n,strokeWidth:o,makeSmoothSvg:t&&s},n&&(document.querySelector(".loading").style.display="block"),document.querySelector(".experimental--smoth-svg--container").style.display=s?"block":"none",document.querySelector(".experimental--smoth-svg--container--warning").style.display=t?"none":"block",Y(de)}K();document.querySelector("#inp").addEventListener("change",me);document.querySelector("#inputbutton").addEventListener("click",()=>{document.querySelector("#inp").click()});document.querySelectorAll("[data-start-drawing]").forEach(e=>{e.addEventListener("change",X(K,256))});document.querySelector("#inputSmoothness").addEventListener("change",X(()=>{const e=U(w.coords,I(q({},v),{size:[w.width,w.height],smoothing:document.querySelector("#inputSmoothness").value/100}));document.querySelector(".smooth-svg-container").innerHTML=e},128));document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=he(w.coords,I(q({},v),{size:[w.width,w.height]})),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(n);e.href=r,e.click()});document.querySelector("#downloadSmoothSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=U(w.coords,{CONFIG:v,size:[w.width,w.height],smoothing:document.querySelector("#inputSmoothness").value/100}),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(n);e.href=r,e.click()});
