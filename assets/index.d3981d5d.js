import{i as _,c as D}from"./vendor.d7bea3fb.js";const W=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}};W();const M=.1,b={r:.299+M,g:.587+M*-.5,b:.114+M*-.5};function x(e){let t=e.data,r=1/0,a=0,n=0;for(let i=0;i<t.length;i+=4){let l=t[i]*b.r+t[i+1]*b.g+t[i+2]*b.b;r=Math.min(r,l),a=Math.max(a,l),n+=l}n=Math.round(n/(t.length/4)),r+=32,a-=32;const o=255/(a-r);for(let i=0;i<t.length;i+=4){let l=t[i]*b.r+t[i+1]*b.g+t[i+2]*b.b;t[i]=Math.round(l*o)-r,t[i+1]=Math.round(l*o)-r,t[i+2]=Math.round(l*o)-r}return{canvasData:e,averageLightness:n}}function I(e,t,r,a){let n=0,o=0,i=0;const l=e[0],g=t[0]-e[0],C=e[1],w=t[1]-e[1],h=Math.max(Math.abs(g),Math.abs(w));for(let p=0;p<h;p++){const c=Math.round(l+g/h*p),R=Math.round(C+w/h*p),m=r[c][R];n+=m.r,o+=m.g,i+=m.b}return a?(n+o+i)/(255*3*h):[Math.round(n/h),Math.round(o/h),Math.round(i/h)]}function G(e){return`<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg" stroke="black">
${e.map(t=>`<line x1="${t[0][0]}" y1="${t[0][1]}" x2="${t[1][0]}" y2="${t[1][1]}"/>`).join(`
`)}
</svg>
  `}function F(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function U(e,t){let r;return function(){clearTimeout(r);let a=arguments;r=setTimeout(function(){e.apply(this,a)},t||1)}}function v(e,t,r={}){const{color:a="#0008",close:n=!1,shiftY:o=0}=r;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+o);for(const i of t)e.lineTo(i._x,i._y+o);n&&e.lineTo(t[0]._x,t[0]._y+o),e.strokeStyle=a,e.stroke()}async function P(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("weights");const r=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!r)return;const a=r.landmarks.getRightEye(),n=r.landmarks.getLeftEye(),o=r.landmarks.getJawOutline();v(t,a,{close:!0}),v(t,n,{close:!0}),v(t,o.slice(2,-2),{color:"#0004",shiftY:10})}function q(e){e.beginPath();function t(n,o,i={}){const{color:l="#000",width:g=1}=i;e.beginPath(),e.lineWidth=g,e.moveTo(n[0],n[1]),e.lineTo(o[0],o[1]),e.strokeStyle=l,e.stroke()}function r(n,o){e.moveTo(n[0],n[1]),e.lineTo(o[0],o[1])}function a(n={}){const{color:o="#000",width:i=1}=n;e.lineWidth=i,e.strokeStyle=o,e.stroke(),e.beginPath()}return{line:t,lineBuffer:r,stroke:a}}window.IMAGE_SRC="./test.jpg";window.CURRENT_DRAWING=new Date().getTime();window.COORDS=[];const u=1080,A={singleLine:!0,faceApi:!1,baseLineNumber:4*1e3,updateSampleRate:128,addColor:"#000",substractionColor:"rgba(255,255,255,30%)",precisionRange:[16,28],strokeWidth:1},s=JSON.parse(JSON.stringify(A)),O=document.querySelector("canvas#src"),L=document.querySelector("canvas#draw");L.width=u;L.height=u;const k=L.getContext("2d"),E=q(k),d={matrix:[]};async function N(e){const t=new Date().getTime();window.CURRENT_DRAWING=new Date().getTime(),window.COORDS=[],k.fillStyle="#fff",k.fillRect(0,0,u,u),document.querySelector("#srcimg").style.backgroundImage=`url("${e}")`;const r=await _(e,{size:u,canvas:O}),{canvasData:a,averageLightness:n}=x(r);if(r.ctx.putImageData(a,0,0),s.faceApi)try{await P(O,r.ctx)}catch{console.warn("no face")}document.querySelector(".loading").style.display="none";const o=r.ctx;d.matrix=D(o);const i=q(r.ctx);let l=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];for(;d.matrix[l[0]][l[1]].r+d.matrix[l[0]][l[1]].g+d.matrix[l[0]][l[1]].b===255*3;)l=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];function g(){let c=l,R=s.singleLine?0:s.precisionRange[0]*2;for(;R--;){let f=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];d.matrix[c[0]][c[1]].r+d.matrix[c[0]][c[1]].g+d.matrix[c[0]][c[1]].b>d.matrix[f[0]][f[1]].r+d.matrix[f[0]][f[1]].g+d.matrix[f[0]][f[1]].b&&(c=f)}let m=F(...s.precisionRange),y,S=1;for(;m--;){let f=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];const T=I(c,f,d.matrix,!0);T<=S&&(S=T,y=f)}S=I(c,y,d.matrix,!0),window.COORDS.push([c,y]),E.lineBuffer(c,y,{color:"#000"}),i.lineBuffer(c,y,{color:s.substractionColor}),l=y}let w=Math.floor(s.baseLineNumber/n*128);function h(c){return new Promise(R=>{const m=new Date().getTime();for(;new Date().getTime()<m+16&&w-- >0;){if(c!==window.CURRENT_DRAWING)return;w%s.updateSampleRate==0&&(E.stroke({color:s.addColor,width:s.strokeWidth*1}),i.stroke({color:s.substractionColor,width:s.strokeWidth*1.5}),d.matrix=D(o)),g()}E.stroke({color:s.addColor,width:s.strokeWidth*1}),i.stroke({color:s.substractionColor,width:s.strokeWidth*1.5}),window.requestAnimationFrame(R)})}async function p(c){for(;w>0&&c===window.CURRENT_DRAWING;)await h(c);console.log("Lines per second:",s.baseLineNumber/(new Date().getTime()-t)*1e3)}p(window.CURRENT_DRAWING)}N(window.IMAGE_SRC);function B(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",function(t){window.IMAGE_SRC=t.target.result,N(window.IMAGE_SRC)}),e.readAsDataURL(this.files[0])}}function $(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,r=document.querySelector("input[type='range']#faceapi").value,a=document.querySelector("input[type='range']#contrast").value,n=document.querySelector("input[type='range']#definition").value,o=document.querySelector("input[type='range']#strokeWidth").value;console.warn(o),s.baseLineNumber=A.baseLineNumber/50*e,s.substractionColor=`rgba(255, 255, 255, ${100-a}%)`,s.precisionRange=[n,n*2],s.singleLine=!!Number(t),s.faceApi=!!Number(r),s.strokeWidth=Number(o),s.faceApi&&(document.querySelector(".loading").style.display="block"),N(window.IMAGE_SRC)}document.querySelector("#inp").addEventListener("change",B);document.querySelector("#inputbutton").addEventListener("click",()=>{document.querySelector("#inp").click()});document.querySelectorAll("input[type='range']").forEach(e=>{e.addEventListener("change",U($,256))});document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadsvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=G(window.COORDS),r=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(r);e.href=a,e.click()});
