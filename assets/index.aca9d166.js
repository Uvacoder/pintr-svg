import{i as e,c as t}from"./vendor.d7bea3fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const o=.399,n=.587-.05,r=.064;function a(e,t,o,n){let r=0,a=0,i=0;const c=e[0],l=t[0]-e[0],s=e[1],d=t[1]-e[1],u=Math.max(Math.abs(l),Math.abs(d));for(let f=0;f<u;f++){const e=Math.round(c+l/u*f),t=Math.round(s+d/u*f),n=o[e][t];r+=n.r,a+=n.g,i+=n.b}return n?(r+a+i)/(765*u):[Math.round(r/u),Math.round(a/u),Math.round(i/u)]}function i(e,t,o={}){const{color:n="#0008",close:r=!1,shiftY:a=0}=o;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+a);for(const i of t)e.lineTo(i._x,i._y+a);r&&e.lineTo(t[0]._x,t[0]._y+a),e.strokeStyle=n,e.stroke()}function c(e){return e.beginPath(),{line:function(t,o,n={}){const{color:r="#000",width:a=1}=n;e.beginPath(),e.lineWidth=a,e.moveTo(t[0],t[1]),e.lineTo(o[0],o[1]),e.strokeStyle=r,e.stroke()},lineBuffer:function(t,o){e.moveTo(t[0],t[1]),e.lineTo(o[0],o[1])},stroke:function(t={}){const{color:o="#000",width:n=1}=t;e.lineWidth=n,e.strokeStyle=o,e.stroke(),e.beginPath()}}}window.IMAGE_SRC="./test.jpg",window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[];const l={singleLine:!0,faceApi:!1,baseLineNumber:4e3,updateSampleRate:128,addColor:"#000",substractionColor:"rgba(255,255,255,30%)",precisionRange:[16,28]},s=JSON.parse(JSON.stringify(l)),d=document.querySelector("canvas#src"),u=document.querySelector("canvas#draw");u.width=1080,u.height=1080;const f=u.getContext("2d"),m=c(f),h={matrix:[]};async function g(l){window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[],f.fillStyle="#fff",f.fillRect(0,0,1080,1080),document.querySelector("#srcimg").style.backgroundImage=`url("${l}")`;const u=await e(l,{size:1080,canvas:d}),{canvasData:g,averageLightness:w}=function(e){let t=e.data,a=1/0,i=0,c=0;for(let s=0;s<t.length;s+=4){let e=t[s]*o+t[s+1]*n+t[s+2]*r;a=Math.min(a,e),i=Math.max(i,e),c+=e}c=Math.round(c/(t.length/4)),a+=32,i-=32;const l=255/(i-a);for(let s=0;s<t.length;s+=4){let e=t[s]*o+t[s+1]*n+t[s+2]*r;t[s]=Math.round(e*l)-a,t[s+1]=Math.round(e*l)-a,t[s+2]=Math.round(e*l)-a}return{canvasData:e,averageLightness:c}}(u);if(u.ctx.putImageData(g,0,0),s.faceApi)try{await async function(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("weights");const o=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!o)return;const n=o.landmarks.getRightEye(),r=o.landmarks.getLeftEye(),a=o.landmarks.getJawOutline();i(t,n,{close:!0}),i(t,r,{close:!0}),i(t,a.slice(2,-2),{color:"#0004",shiftY:10})}(d,u.ctx)}catch(v){console.warn("no face")}document.querySelector(".loading").style.display="none";const p=u.ctx;h.matrix=t(p);const y=c(u.ctx);let M=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];for(;h.matrix[M[0]][M[1]].r+h.matrix[M[0]][M[1]].g+h.matrix[M[0]][M[1]].b===765;)M=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];function b(){let e=M,t=s.singleLine?0:2*s.precisionRange[0];for(;t--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];h.matrix[e[0]][e[1]].r+h.matrix[e[0]][e[1]].g+h.matrix[e[0]][e[1]].b>h.matrix[t[0]][t[1]].r+h.matrix[t[0]][t[1]].g+h.matrix[t[0]][t[1]].b&&(e=t)}let o,n=function(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}(...s.precisionRange),r=1;for(;n--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];const n=a(e,t,h.matrix,!0);n<=r&&(r=n,o=t)}r=a(e,o,h.matrix,!0),window.COORDS.push([e,o]),m.lineBuffer(e,o,{color:"#000"}),y.lineBuffer(e,o,{color:s.substractionColor}),M=o}let R=Math.floor(s.baseLineNumber/w*128);function S(e){return new Promise((o=>{const n=(new Date).getTime();for(;(new Date).getTime()<n+15&&R-- >0;){if(e!==window.CURRENT_DRAWING)return;R%s.updateSampleRate==0&&(m.stroke({color:s.addColor}),y.stroke({color:s.substractionColor,width:1.5}),h.matrix=t(p)),b()}m.stroke({color:s.addColor}),y.stroke({color:s.substractionColor,width:1.5}),window.requestAnimationFrame(o)}))}!async function(e){for(;R>0&&e===window.CURRENT_DRAWING;)await S(e)}(window.CURRENT_DRAWING)}function w(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,o=document.querySelector("input[type='range']#faceapi").value,n=document.querySelector("input[type='range']#contrast").value,r=document.querySelector("input[type='range']#definition").value;s.baseLineNumber=l.baseLineNumber/50*e,s.substractionColor=`rgba(255, 255, 255, ${100-n}%)`,s.precisionRange=[r,2*r],s.singleLine=!!Number(t),s.faceApi=!!Number(o),s.faceApi&&(document.querySelector(".loading").style.display="block"),g(window.IMAGE_SRC)}g(window.IMAGE_SRC),document.querySelector("#inp").addEventListener("change",(function(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",(function(e){window.IMAGE_SRC=e.target.result,g(window.IMAGE_SRC)})),e.readAsDataURL(this.files[0])}})),document.querySelector("#inputbutton").addEventListener("click",(()=>{document.querySelector("#inp").click()})),document.querySelectorAll("input[type='range']").forEach((e=>{e.addEventListener("change",function(e,t){let o;return function(){clearTimeout(o);let n=arguments;o=setTimeout((function(){e.apply(this,n)}),t||1)}}(w,256))})),document.querySelector("#download").addEventListener("click",(()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()})),document.querySelector("#downloadsvg").addEventListener("click",(()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=`<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">\n  <polyline points="${window.COORDS.map((e=>e[0].join(","))).join(" ")}" fill="none" stroke="black" />\n</svg>\n  `;const o=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(o);e.href=n,e.click()}));
