import{i as O,c as T}from"./vendor.d7bea3fb.js";const _=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}};_();const M=.1,g={r:.299+M,g:.587+M*-.5,b:.114+M*-.5};function G(e){let t=e.data,i=1/0,a=0,n=0;for(let o=0;o<t.length;o+=4){let c=t[o]*g.r+t[o+1]*g.g+t[o+2]*g.b;i=Math.min(i,c),a=Math.max(a,c),n+=c}n=Math.round(n/(t.length/4)),i+=32,a-=32;const r=255/(a-i);for(let o=0;o<t.length;o+=4){let c=t[o]*g.r+t[o+1]*g.g+t[o+2]*g.b;t[o]=Math.round(c*r)-i,t[o+1]=Math.round(c*r)-i,t[o+2]=Math.round(c*r)-i}return{canvasData:e,averageLightness:n}}function I(e,t,i,a){let n=0,r=0,o=0;const c=e[0],w=t[0]-e[0],p=e[1],b=t[1]-e[1],h=Math.max(Math.abs(w),Math.abs(b));for(let s=0;s<h;s++){const y=Math.round(c+w/h*s),R=Math.round(p+b/h*s),f=i[y][R];n+=f.r,r+=f.g,o+=f.b}return a?(n+r+o)/(255*3*h):[Math.round(n/h),Math.round(r/h),Math.round(o/h)]}function x(e){return`<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${e.map(t=>t[0].join(",")).join(" ")}" fill="none" stroke="black" />
</svg>
  `}function F(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function P(e,t){let i;return function(){clearTimeout(i);let a=arguments;i=setTimeout(function(){e.apply(this,a)},t||1)}}function v(e,t,i={}){const{color:a="#0008",close:n=!1,shiftY:r=0}=i;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+r);for(const o of t)e.lineTo(o._x,o._y+r);n&&e.lineTo(t[0]._x,t[0]._y+r),e.strokeStyle=a,e.stroke()}async function U(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("weights");const i=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!i)return;const a=i.landmarks.getRightEye(),n=i.landmarks.getLeftEye(),r=i.landmarks.getJawOutline();v(t,a,{close:!0}),v(t,n,{close:!0}),v(t,r.slice(2,-2),{color:"#0004",shiftY:10})}function D(e){e.beginPath();function t(n,r,o={}){const{color:c="#000",width:w=1}=o;e.beginPath(),e.lineWidth=w,e.moveTo(n[0],n[1]),e.lineTo(r[0],r[1]),e.strokeStyle=c,e.stroke()}function i(n,r){e.moveTo(n[0],n[1]),e.lineTo(r[0],r[1])}function a(n={}){const{color:r="#000",width:o=1}=n;e.lineWidth=o,e.strokeStyle=r,e.stroke(),e.beginPath()}return{line:t,lineBuffer:i,stroke:a}}window.IMAGE_SRC="./test.jpg";window.CURRENT_DRAWING=new Date().getTime();window.COORDS=[];const u=1080,A={singleLine:!0,faceApi:!1,baseLineNumber:4*1e3,updateSampleRate:128,addColor:"#000",substractionColor:"rgba(255,255,255,30%)",precisionRange:[16,28]},l=JSON.parse(JSON.stringify(A)),q=document.querySelector("canvas#src"),L=document.querySelector("canvas#draw");L.width=u;L.height=u;const E=L.getContext("2d"),C=D(E),d={matrix:[]};async function N(e){window.CURRENT_DRAWING=new Date().getTime(),window.COORDS=[],E.fillStyle="#fff",E.fillRect(0,0,u,u),document.querySelector("#srcimg").style.backgroundImage=`url("${e}")`;const t=await O(e,{size:u,canvas:q}),{canvasData:i,averageLightness:a}=G(t);if(t.ctx.putImageData(i,0,0),l.faceApi)try{await U(q,t.ctx)}catch{console.warn("no face")}document.querySelector(".loading").style.display="none";const n=t.ctx;d.matrix=T(n);const r=D(t.ctx);let o=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];for(;d.matrix[o[0]][o[1]].r+d.matrix[o[0]][o[1]].g+d.matrix[o[0]][o[1]].b===255*3;)o=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];function c(){let s=o,y=l.singleLine?0:l.precisionRange[0]*2;for(;y--;){let m=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];d.matrix[s[0]][s[1]].r+d.matrix[s[0]][s[1]].g+d.matrix[s[0]][s[1]].b>d.matrix[m[0]][m[1]].r+d.matrix[m[0]][m[1]].g+d.matrix[m[0]][m[1]].b&&(s=m)}let R=F(...l.precisionRange),f,S=1;for(;R--;){let m=[Math.floor(Math.random()*u),Math.floor(Math.random()*u)];const k=I(s,m,d.matrix,!0);k<=S&&(S=k,f=m)}S=I(s,f,d.matrix,!0),window.COORDS.push([s,f]),C.lineBuffer(s,f,{color:"#000"}),r.lineBuffer(s,f,{color:l.substractionColor}),o=f}let p=Math.floor(l.baseLineNumber/a*128);function b(s){return new Promise(y=>{const R=new Date().getTime();for(;new Date().getTime()<R+15&&p-- >0;){if(s!==window.CURRENT_DRAWING)return;p%l.updateSampleRate==0&&(C.stroke({color:l.addColor}),r.stroke({color:l.substractionColor,width:1.5}),d.matrix=T(n)),c()}C.stroke({color:l.addColor}),r.stroke({color:l.substractionColor,width:1.5}),window.requestAnimationFrame(y)})}async function h(s){for(;p>0&&s===window.CURRENT_DRAWING;)await b(s)}h(window.CURRENT_DRAWING)}N(window.IMAGE_SRC);function W(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",function(t){window.IMAGE_SRC=t.target.result,N(window.IMAGE_SRC)}),e.readAsDataURL(this.files[0])}}function B(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,i=document.querySelector("input[type='range']#faceapi").value,a=document.querySelector("input[type='range']#contrast").value,n=document.querySelector("input[type='range']#definition").value;l.baseLineNumber=A.baseLineNumber/50*e,l.substractionColor=`rgba(255, 255, 255, ${100-a}%)`,l.precisionRange=[n,n*2],l.singleLine=!!Number(t),l.faceApi=!!Number(i),l.faceApi&&(document.querySelector(".loading").style.display="block"),N(window.IMAGE_SRC)}document.querySelector("#inp").addEventListener("change",W);document.querySelector("#inputbutton").addEventListener("click",()=>{document.querySelector("#inp").click()});document.querySelectorAll("input[type='range']").forEach(e=>{e.addEventListener("change",P(B,256))});document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadsvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=x(window.COORDS),i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(i);e.href=a,e.click()});
