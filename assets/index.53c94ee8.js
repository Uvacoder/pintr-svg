var B=Object.defineProperty,z=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var _=(e,t,n)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,L=(e,t)=>{for(var n in t||(t={}))H.call(t,n)&&_(e,n,t[n]);if($)for(var n of $(t))Z.call(t,n)&&_(e,n,t[n]);return e},I=(e,t)=>z(e,j(t));const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}};Y();function A(e){const{data:t}=e.getImageData(0,0,e.canvas.width,e.canvas.height),{width:n,height:i}=e.canvas;let a=[];for(let o=0;o<i;o++)for(let r=0;r<n;r++)a[r]||(a[r]=[]),a[r][o]=Math.floor((t[o*n*4+r*4]+t[o*n*4+r*4+1]+t[o*n*4+r*4+2])/3);return a}function J(e,t={}){const{crop:n=!0,size:i}=t;return new Promise(a=>{const o=new window.Image;o.onload=function(){const l=t.canvas||document.createElement("canvas"),u=l.getContext("2d");let s=1;i&&(s=i/Math.max(o.width,o.height)),t.maxSize&&(o.width>t.maxSize||o.height>t.maxSize)&&(s=t.maxSize/Math.max(o.width,o.height));const h=Math.floor(o.width*s),g=Math.floor(o.height*s);if(n){l.width=i,l.height=i;const w=Math.min(o.width,o.height);u.drawImage(o,(o.width-w)/2,(o.height-w)/2,w,w,0,0,i,i)}else l.width=h,l.height=g,u.drawImage(o,0,0,h,g);const m=u.getImageData(0,0,u.canvas.width,u.canvas.height);m.ctx=u,a(m)},o.src=e})}const T=.1,R={r:.299+T,g:.587+T*-.5,b:.114+T*-.5};function X(e){let t=e.data,n=1/0,i=0,a=0;for(let r=0;r<t.length;r+=4){let l=t[r]*R.r+t[r+1]*R.g+t[r+2]*R.b;n=Math.min(n,l),i=Math.max(i,l),a+=l}a=Math.round(a/(t.length/4)),n+=32,i-=32;const o=255/(i-n);for(let r=0;r<t.length;r+=4){let l=t[r]*R.r+t[r+1]*R.g+t[r+2]*R.b;t[r]=Math.round(l*o)-n,t[r+1]=Math.round(l*o)-n,t[r+2]=Math.round(l*o)-n}return{canvasData:e,averageLightness:a}}function x(e,t,n){let i=0;const a=e[0],o=t[0]-e[0],r=e[1],l=t[1]-e[1],u=Math.max(Math.abs(o),Math.abs(l));for(let s=0;s<u;s++){const h=Math.round(a+o/u*s),g=Math.round(r+l/u*s);i+=n[h][g]}return Math.round(i/u)}function K(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${t}">
${e.map(i=>`<line x1="${i[0][0]}" y1="${i[0][1]}" x2="${i[1][0]}" y2="${i[1][1]}"/>`).join(`
`)}
</svg>
  `}function Q(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${e.map(i=>i[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${t}"/>
</svg>
  `}function V(e,t){return console.warn(">generateSvg",t),t.singleLine?Q(e,t):K(e,t)}function q(e,{strokeWidth:t,size:n}){const i=.15,a=e.map(s=>s[0]),o=(s,h)=>{const g=h[0]-s[0],m=h[1]-s[1];return{length:Math.sqrt(Math.pow(g,2)+Math.pow(m,2)),angle:Math.atan2(m,g)}},r=(s,h,g,m)=>{const d=o(h||s,g||s),f=d.angle+(m?Math.PI:0),p=d.length*i,y=s[0]+Math.cos(f)*p,E=s[1]+Math.sin(f)*p;return[y,E]},l=(s,h,g)=>{const m=r(g[h-1],g[h-2],s),w=r(s,g[h-1],g[h+1],!0);return`C ${m[0]},${m[1]} ${w[0]},${w[1]} ${s[0]},${s[1]}`},u=(s,h)=>`<path d="${s.reduce((m,w,M,d)=>M===0?`M ${w[0]},${w[1]}`:`${m} ${h(w,M,d)}`,"")}" fill="none" stroke="black" stroke-width="${t}" />`;return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${u(a,l)}
  </svg>
  `}function ee(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function te(e,t){let n;return function(){clearTimeout(n);let i=arguments;n=setTimeout(function(){e.apply(this,i)},t||1)}}function N(e,t,n={}){const{color:i="#0008",close:a=!1,shiftY:o=0}=n;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+o);for(const r of t)e.lineTo(r._x,r._y+o);a&&e.lineTo(t[0]._x,t[0]._y+o),e.strokeStyle=i,e.stroke()}async function ne(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("weights");const n=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!n)return;const i=n.landmarks.getRightEye(),a=n.landmarks.getLeftEye(),o=n.landmarks.getJawOutline();N(t,i,{close:!0}),N(t,a,{close:!0}),N(t,o.slice(2,-2),{color:"#0004",shiftY:10})}function O(e){e.beginPath();function t(a,o,r={}){const{color:l="#000",width:u=1}=r;e.beginPath(),e.lineWidth=u,e.moveTo(a[0],a[1]),e.lineTo(o[0],o[1]),e.strokeStyle=l,e.stroke()}function n(a,o){e.moveTo(a[0],a[1]),e.lineTo(o[0],o[1])}function i(a={}){const{color:o="#000",width:r=1}=a;e.lineWidth=r,e.strokeStyle=o,e.stroke(),e.beginPath()}return{line:t,lineBuffer:n,stroke:i}}const b=1080;window.IMAGE_SRC="./test.jpg";window.CURRENT_DRAWING=new Date().getTime();window.COORDS=[];window.CURRENT_IMAGE_SIZE=[b,b];const G={addColor:"#000",baseLineNumber:3600,faceApi:!1,precisionRange:2[32],singleLine:!0,strokeWidth:1.25,substractionColor:"rgba(255, 255, 255, 30%)",updateSampleRate:100},c=JSON.parse(JSON.stringify(G)),P=document.querySelector("canvas#src"),k=document.querySelector("canvas#draw");k.width=b;k.height=b;const C=k.getContext("2d"),U=O(C),S={matrix:[]};async function W(e){console.log(c);const t=new Date().getTime();window.CURRENT_DRAWING=new Date().getTime(),window.COORDS=[],document.querySelector("#srcimg").style.backgroundImage=`url("${e}")`;const n=await J(e,{size:b,canvas:P,crop:!1}),i=n.width,a=n.height;window.CURRENT_IMAGE_SIZE=[i,a],C.fillStyle="#fff",C.fillRect(0,0,i,a),document.documentElement.style.setProperty("--sizew",`${i/2}px`),document.documentElement.style.setProperty("--sizeh",`${a/2}px`),k.width=i,k.height=a;const{canvasData:o,averageLightness:r}=X(n);if(n.ctx.putImageData(o,0,0),c.faceApi)try{await ne(P,n.ctx)}catch{console.warn("No face detected or FaceAPI not working.")}document.querySelector(".loading").style.display="none";const l=n.ctx;S.matrix=A(l);const u=O(n.ctx);let s=[Math.floor(i/2),Math.floor(a/2)];for(;S.matrix[s[0]][s[1]]===255*3;)s=[Math.floor(Math.random()*i),Math.floor(Math.random()*a)];function h(){let d=s,f=c.singleLine?0:c.precisionRange[0]*2;for(;f--;){let v=[Math.floor(Math.random()*i),Math.floor(Math.random()*a)];S.matrix[d[0]][d[1]]>S.matrix[v[0]][v[1]]&&(d=v)}let p=ee(...c.precisionRange),y,E=255;for(;p--;){let v=[Math.floor(Math.random()*i),Math.floor(Math.random()*a)];const D=x(d,v,S.matrix);D<=E&&(E=D,y=v)}E=x(d,y,S.matrix),window.COORDS.push([d,y]),U.lineBuffer(d,y,{color:"#000"}),u.lineBuffer(d,y,{color:c.substractionColor}),s=y}let m=Math.floor(c.baseLineNumber/r*128);function w(d){return new Promise(f=>{const p=new Date().getTime();for(;new Date().getTime()<p+16&&m-- >0;){if(d!==window.CURRENT_DRAWING)return;m%c.updateSampleRate==0&&(u.stroke({color:c.substractionColor,width:c.strokeWidth*1.5}),S.matrix=A(l)),h()}U.stroke({color:c.addColor,width:c.strokeWidth*1}),window.requestAnimationFrame(f)})}async function M(d){for(;m>0&&d===window.CURRENT_DRAWING;)await w(d);if(c.makeSmoothSvg){const f=q(window.COORDS,I(L({},c),{size:window.CURRENT_IMAGE_SIZE}));document.querySelector(".smooth-svg-container").innerHTML=f}console.log("Lines per second:",c.baseLineNumber/(new Date().getTime()-t)*1e3)}M(window.CURRENT_DRAWING)}function oe(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",function(t){window.IMAGE_SRC=t.target.result,W(window.IMAGE_SRC)}),e.readAsDataURL(this.files[0])}}function F(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,n=document.querySelector("input[type='range']#faceapi").value,i=document.querySelector("input[type='range']#contrast").value,a=document.querySelector("input[type='range']#definition").value,o=document.querySelector("input[type='range']#strokeWidth").value,r=document.querySelector("input[type='range']#makeSmoothSvg").value;c.baseLineNumber=G.baseLineNumber/50*e,c.substractionColor=`rgba(255, 255, 255, ${100-i}%)`,c.precisionRange=[a,a*2],c.singleLine=!!Number(t),c.faceApi=!!Number(n),c.strokeWidth=Number(o),c.makeSmoothSvg=c.singleLine&&!!Number(r),c.faceApi&&(document.querySelector(".loading").style.display="block"),document.querySelector(".experimental--smoth-svg--container").style.display=c.makeSmoothSvg?"block":"none",W(window.IMAGE_SRC)}F();document.querySelector("#inp").addEventListener("change",oe);document.querySelector("#inputbutton").addEventListener("click",()=>{document.querySelector("#inp").click()});document.querySelectorAll("input[type='range']").forEach(e=>{e.addEventListener("change",te(F,256))});document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadsvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=V(window.COORDS,I(L({},c),{size:window.CURRENT_IMAGE_SIZE})),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(n);e.href=i,e.click()});document.querySelector("#downloadSmoothSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=q(window.COORDS,{CONFIG:c,size:window.CURRENT_IMAGE_SIZE}),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(n);e.href=i,e.click()});
